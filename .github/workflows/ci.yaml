name: specs-workflow

on:
    pull_request:
        branches:
        - '*'
    push:
        branches:
        - master
        - main
    workflow_dispatch:

jobs:
    specs:
        # strategy:
          # matrix:
             # os:
             # - actuated-4cpu-4gb
             # - actuated-arm64-4cpu-4gb
             # - ubuntu-latest

        # name: specs-${{ matrix.os }}
        # runs-on: ${{ matrix.os }}
        name: specs
        runs-on: [actuated-arm64-8cpu-12gb, q80]

        steps:
# vmmeter start
        - uses: alexellis/arkade-get@master
          with:
            crane: latest
            print-summary: false
        - name: Install vmmeter
          run: |
            ARCH=amd64
            if [ "$(uname -m)" == "aarch64" ] ; then ARCH=arm64 ; fi
            crane export --platform linux/$ARCH ghcr.io/openfaasltd/vmmeter:latest | sudo tar -xvf - -C /usr/local/bin
        - uses: self-actuated/vmmeter-action@master
# vmmeter end

        - uses: actions/checkout@v1

        - name: Check specs
          run: |
            ./specs.sh
